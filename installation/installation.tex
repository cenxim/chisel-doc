\documentclass[twocolumn, 10pt]{article}
\setlength\textwidth{6.875in}
\setlength\textheight{8.875in}
% set both margins to 2.5 pc
\setlength{\oddsidemargin}{-0.1875in}% 1 - (8.5 - 6.875)/2
\setlength{\evensidemargin}{-0.1875in}
\setlength{\marginparwidth}{0pc}
\setlength{\marginparsep}{0pc}%
\setlength{\topmargin}{0in} \setlength{\headheight}{0pt}
\setlength{\headsep}{0pt}
\setlength{\footskip}{37pt}%
%\setlength{\columnsep}{0.3125in}
%\setlength{\columnwidth}{3.28125in}% (6.875 - 0.3125)/2 = 3.28125in
\setlength{\parindent}{1pc}
\newcommand{\myMargin}{1.00in}
\usepackage[top=\myMargin, left=\myMargin, right=\myMargin, bottom=\myMargin, nohead]{geometry}
\usepackage{epsfig,graphicx}
\usepackage{palatino}
\usepackage{fancybox}
\usepackage{hyperref}
\usepackage[procnames]{listings}

\input{../style/scala.tex}

\lstset{basicstyle={\footnotesize\ttfamily}}

\newenvironment{commentary}
{ \vspace{-0.1in}
  \begin{quotation}
  \noindent
  \small \em
  \rule{\linewidth}{1pt}\\
}
{
  \end{quotation}
}

% \newenvironment{kode}%
% {\footnotesize
%  %\setlength{\parskip}{0pt}
%   %\setlength{\topsep}{0pt}
%   %\setlength{\partopsep}{0pt}
%  \verbatim}
% {\endverbatim 
% %\vspace*{-0.1in}
%  }

% \newenvironment{kode}%
% {\VerbatimEnvironment
% \footnotesize\begin{Sbox}\begin{minipage}{6in}\begin{Verbatim}}%
% {\end{Verbatim}\end{minipage}\end{Sbox}
% \setlength{\fboxsep}{8pt}\fbox{\TheSbox}}

% \newenvironment{kode}
% {\begin{Sbox}
% \footnotesize
% \begin{minipage}{6in}
%   %\setlength{\parskip}{0pt}
%   %\setlength{\topsep}{0pt}
%   %\setlength{\partopsep}{0pt}
%   \verbatim}
% {\endverbatim 
% \end{minipage}
% \end{Sbox} 
% \fbox{\TheSbox}
%  %\vspace*{-0.1in}
%  }

\title{Chisel Installation}
\author{Jonathan Bachrach \\
EECS Department, UC Berkeley\\
{\tt  \{jrb\}@eecs.berkeley.edu}
}
\date{\today}

\newenvironment{example}{\VerbatimEnvironment\begin{footnotesize}\begin{Verbatim}}{\end{Verbatim}\end{footnotesize}}
\newcommand{\kode}[1]{\begin{footnotesize}{\tt #1}\end{footnotesize}}

\def\code#1{{\tt #1}}

\def\note#1{\noindent{\bf [Note: #1]}}
%\def\note#1{}

\begin{document}
\maketitle{}

\section{Introduction}

This document is a installation guide for {\em Chisel} (Constructing
Hardware In a Scala Embedded Language).  Chisel is a hardware
construction language embedded in the high-level programming language
Scala.  

\section{Setting Up Chisel}

\subsection{Github}

\begin{itemize}
\item Get an account on \verb|www.github.com|
\item Register your public key on \verb|github.com|
\end{itemize}

\subsection{Install}

\subsubsection{MacOSX}

\begin{enumerate}
\item Install XCODE including console tools.
\item Install MacPorts from \url{http://www.macports.org}
\end{enumerate}

\noindent
From there install the following MacPorts packages:

\begin{enumerate}
\item \verb+git+
\item \verb+openjdk6+
\end{enumerate}

\noindent
using

\begin{bash}
sudo port install
\end{bash}

\subsubsection{Linux}

To install Chisel on Linux, install the following packages:

\begin{enumerate}
\item \verb+git+
\item \verb|g++|
\item \verb+openjdk-7-jre+
\item \verb+openjdk-7-jdk+
\end{enumerate}

\noindent
using

\begin{bash}
sudo apt-get install
\end{bash}

% To install Chisel on Linux, download and run the \verb|install| script 
% provided on the website. Note: python must be installed for 
% this script to work. The script does the following:
% \begin{enumerate}
%   \item installs \verb|g++| if necessary
%   \item installs Java runtime and compiler if necessary
%   \item installs \verb+git+ if necessary
%   \item prompts for a location to install Chisel (needs an absolute path)\label{step:chiseldir}
%   \item clones Chisel into the location provided by Step~\ref{step:chiseldir}
% \end{enumerate}
% 
% After running the installation script, you need to set the CHISEL
% environment variable in your bashrc file to point to where you
% installed Chisel in Step~\ref{step:chiseldir}.
% 
% \subsection{Verify}
% To verify that everything has been configured correctly, download 
% run the \verb|verify| script provided on teh website. The
% script will run the compiler on simple use case. If everything
% goes correctly, you should find the following files in 
% $CHISEL/emulator:
% \begin{itemize}
%   \item GCD-emulator.cpp
%   \item GCD-makefile
%   \item GCD.h
%   \item GCD.cpp
% \end{itemize}

\subsubsection{Windows}

\begin{itemize}
\item \textbf{Install Cygwin} --
Go to \url{http://cygwin.com/install.html} and run \verb+Setup.exe+.
Make sure that you are installing at least the following packages.  Basic packages like editors are also required if you want to use Chisel.):
\begin{itemize}
\item git
\item g++
\item make
\end{itemize}
\item \textbf{Pull Chisel from repository} -- run
\begin{bash}
git clone git://github.com/ucb-bar/chisel/
\end{bash}
\item \textbf{Some fixes in Cygwin Environment variables} --
set CHISEL environment variable to chisel directory
like: 
\begin{bash}
export CHISEL=~/chisel
\end{bash}
Add sbt file with the following contexts to \verb+$CHISEL/tutorial/sbt+ directory (you will have an sbt file inside that directory). Make sure that you \verb!chmod +x! the sbt file

\begin{bash}
java -Xmx512M -jar sbt-launch.jar “$@”
\end{bash}

In the same directory (\verb+$CHISEL/tutorial/sbt+) make sure that sbt-launch.jar is a hard link not a symbolic link. You can make it a hard link by
\begin{bash}
rm sbt-launch.jar; ln ../../sbt/sbt-launch.jar sbt-launch.jar
\end{bash}

\item \textbf{Fix the Cygwin heap size if necessary}


On windows command line run:

\begin{bash}
regtool -i set /HKLM/Software/Cygwin/heap_chunk_in_mb 1024
\end{bash}

\item {\bf Put the \verb+cygwin\bin+ directory into the windows path variable:}
(In my case I added \verb+C:\cygwin\bin+ to windows path) this will enable the java to find the g++.exe
\end{itemize}

\section{Github}

\verb+cd+ above directory = \verb+$DIR+ you've chosen to place Chisel and type:

\begin{bash}
cd $DIR
git clone https://github.com/ucb-bar/chisel.git
\end{bash}

\noindent
Your copy of the Chisel repository will then be in \verb+$DIR/chisel+.  Define this as a variable in your bash environment:

\begin{bash}
export CHISEL = $DIR/chisel
\end{bash}

The following is the Chisel directory structure you will find in \verb+$CHISEL+:

\begin{bash}
chisel/      # install chisel at same level as your project
  tutorial/      
  src/       # chisel source code 
  sbt/
  doc/
    manual/
    tutorial/
    installation/
\end{bash}

\section{Setting Up Chisel}

Make sure to set your chisel environment variable in bash or your favorite shell:

\begin{bash}
export CHISEL = $CHISEL
\end{bash}

\noindent
and put this into your \verb+.bashrc+ file or similar shell initialization file.

\section{Getting Started with Tutorial}

Test your configuration as follows:

\begin{bash}
cd $CHISEL/tutorial/emulator
make GCD
\end{bash}

% \noindent
% Then test that C++ was generated correctly as follows:
% 
% \begin{bash}
% cd $CHISEL/tutorial/emulator
% make -f GCD-Makefile
% GCD
% \end{bash}

\section{Creating Your Own Projects}

SBT has a particular directory structure that we adhere to and
somewhat improve.  Assuming that we have a project named {\em gpu},
then the following would be the directory structure template:

\begin{bash}
gpu/
  sbt/
    project/
      build.scala # edit this as shown below
  src/ 
    gpu.scala     # your source files go here
  emulator/       # your C++ target can go here
\end{bash}

\noindent
and the following is the \verb+build.scala+ template:

\begin{scala}
import sbt._
import Keys._

object BuildSettings
{
  val buildOrganization = "edu.berkeley.cs"
  val buildVersion = "1.1"
  val buildScalaVersion = "2.9.2"

  def apply() = {
    Defaults.defaultSettings ++ Seq (
      organization := buildOrganization,
      version      := buildVersion,
      scalaVersion := buildScalaVersion,
      scalaSource in Compile := Path.absolute(file("../src")),
      libraryDependencies += "edu.berkeley.cs" %% "chisel" % "1.0"
    )
  }
}

object ChiselBuild extends Build
{
  import BuildSettings._

  lazy val gpu = Project("gpu", file("gpu"), settings = BuildSettings()) 
}

object BuildSettings {
  val buildOrganization = "edu.berkeley.cs"
  val buildVersion = "1.1"
  val buildScalaVersion = "2.9.2"

  def apply(projectdir: String) = {
    Defaults.defaultSettings ++ Seq (
      organization := buildOrganization,
      version      := buildVersion,
      scalaVersion := buildScalaVersion,
      scalaSource in Compile := 
        Path.absolute(file(projectdir + "/src"))
    )
  }
}

object ChiselBuild extends Build {
  import BuildSettings._
  val chiselDir = java.lang.System.getenv("CHISEL")
  lazy val chisel = 
    Project("chisel", file("chisel"), 
            settings = BuildSettings(chiselDir))
  lazy val gpu =
    Project("gpu", file("gpu"), 
            settings = BuildSettings("..")) 
      dependsOn(chisel)
}
\end{scala}

\begin{bash}
gpu/
  sbt/
    project/
      build.scala # edit this as shown below
  src/ 
    gpu.scala     # your source files go here
  emulator/       # your C++ target can go here
\end{bash}

\noindent
and the following is the \verb+build.scala+ template:

\begin{scala}
import sbt._
import Keys._

object BuildSettings {
  val buildOrganization = "edu.berkeley.cs"
  val buildVersion = "1.1"
  val buildScalaVersion = "2.9.2"

  def apply(projectdir: String) = {
    Defaults.defaultSettings ++ Seq (
      organization := buildOrganization,
      version      := buildVersion,
      scalaVersion := buildScalaVersion,
      scalaSource in Compile := 
        Path.absolute(file(projectdir + "/src"))
    )
  }
}

object ChiselBuild extends Build {
  import BuildSettings._
  val chiselDir = java.lang.System.getenv("CHISEL")
  lazy val chisel = 
    Project("chisel", file("chisel"), 
            settings = BuildSettings(chiselDir))
  lazy val gpu =
    Project("gpu", file("gpu"), 
            settings = BuildSettings("..")) 
      dependsOn(chisel)
}
\end{scala}

\end{document}
