\documentclass[twocolumn, 10pt]{article}
\setlength\textwidth{6.875in}
\setlength\textheight{8.875in}
% set both margins to 2.5 pc
\setlength{\oddsidemargin}{-0.1875in}% 1 - (8.5 - 6.875)/2
\setlength{\evensidemargin}{-0.1875in}
\setlength{\marginparwidth}{0pc}
\setlength{\marginparsep}{0pc}%
\setlength{\topmargin}{0in} \setlength{\headheight}{0pt}
\setlength{\headsep}{0pt}
\setlength{\footskip}{37pt}%
%\setlength{\columnsep}{0.3125in}
%\setlength{\columnwidth}{3.28125in}% (6.875 - 0.3125)/2 = 3.28125in
\setlength{\parindent}{1pc}
\newcommand{\myMargin}{1.00in}
\usepackage[top=\myMargin, left=\myMargin, right=\myMargin, bottom=\myMargin, nohead]{geometry}
\usepackage{epsfig,graphicx}
\usepackage{palatino}
\usepackage{fancybox}
\usepackage{hyperref}
\usepackage[procnames]{listings}

\input{../style/scala.tex}

\lstset{basicstyle={\footnotesize\ttfamily}}

\newenvironment{commentary}
{ \vspace{-0.1in}
  \begin{quotation}
  \noindent
  \small \em
  \rule{\linewidth}{1pt}\\
}
{
  \end{quotation}
}

% \newenvironment{kode}%
% {\footnotesize
%  %\setlength{\parskip}{0pt}
%   %\setlength{\topsep}{0pt}
%   %\setlength{\partopsep}{0pt}
%  \verbatim}
% {\endverbatim 
% %\vspace*{-0.1in}
%  }

% \newenvironment{kode}%
% {\VerbatimEnvironment
% \footnotesize\begin{Sbox}\begin{minipage}{6in}\begin{Verbatim}}%
% {\end{Verbatim}\end{minipage}\end{Sbox}
% \setlength{\fboxsep}{8pt}\fbox{\TheSbox}}

% \newenvironment{kode}
% {\begin{Sbox}
% \footnotesize
% \begin{minipage}{6in}
%   %\setlength{\parskip}{0pt}
%   %\setlength{\topsep}{0pt}
%   %\setlength{\partopsep}{0pt}
%   \verbatim}
% {\endverbatim 
% \end{minipage}
% \end{Sbox} 
% \fbox{\TheSbox}
%  %\vspace*{-0.1in}
%  }

\title{Chisel Installation}
\author{Jonathan Bachrach \\
EECS Department, UC Berkeley\\
{\tt  \{jrb\}@eecs.berkeley.edu}
}
\date{\today}

\newenvironment{example}{\VerbatimEnvironment\begin{footnotesize}\begin{Verbatim}}{\end{Verbatim}\end{footnotesize}}
\newcommand{\kode}[1]{\begin{footnotesize}{\tt #1}\end{footnotesize}}

\def\code#1{{\tt #1}}

\def\note#1{\noindent{\bf [Note: #1]}}
%\def\note#1{}

\begin{document}
\maketitle{}

\section{Introduction}

This document is an installation guide for {\em Chisel} (Constructing
Hardware In a Scala Embedded Language).  Chisel is a hardware
construction language embedded in the high-level programming language
Scala.  

\subsection{Github}

\begin{itemize}
\item Get an account on \verb|www.github.com|
\item Register your public key on \verb|github.com|
\end{itemize}

\subsection{Development Tool Installation}

\subsubsection{MacOSX}

\begin{enumerate}
\item Install XCODE including console tools.
\item Install MacPorts from \url{http://www.macports.org}
\end{enumerate}

\noindent
From there install the following MacPorts packages:

\begin{enumerate}
\item \verb+git+
\item \verb+openjdk6+
\end{enumerate}

\noindent
using

\begin{bash}
sudo port install
\end{bash}

\subsubsection{Linux}

To install Chisel on Linux, install the following packages:

\begin{enumerate}
\item \verb+git+
\item \verb|g++|
\item \verb+openjdk-7-jre+
\item \verb+openjdk-7-jdk+
\end{enumerate}

\noindent
using

\begin{bash}
sudo apt-get install
\end{bash}

% To install Chisel on Linux, download and run the \verb|install| script 
% provided on the website. Note: python must be installed for 
% this script to work. The script does the following:
% \begin{enumerate}
%   \item installs \verb|g++| if necessary
%   \item installs Java runtime and compiler if necessary
%   \item installs \verb+git+ if necessary
%   \item prompts for a location to install Chisel (needs an absolute path)\label{step:chiseldir}
%   \item clones Chisel into the location provided by Step~\ref{step:chiseldir}
% \end{enumerate}
% 
% After running the installation script, you need to set the CHISEL
% environment variable in your bashrc file to point to where you
% installed Chisel in Step~\ref{step:chiseldir}.
% 
% \subsection{Verify}
% To verify that everything has been configured correctly, download 
% run the \verb|verify| script provided on teh website. The
% script will run the compiler on simple use case. If everything
% goes correctly, you should find the following files in 
% $CHISEL/emulator:
% \begin{itemize}
%   \item GCD-emulator.cpp
%   \item GCD-makefile
%   \item GCD.h
%   \item GCD.cpp
% \end{itemize}

\section{Setting Up Tutorial}

\verb+cd+ above directory = \verb+$DIR+ you've chosen to place Chisel tutorial and type:

\begin{bash}
cd $DIR
git clone https://github.com/ucb-bar/chisel-tutorial.git
\end{bash}

\noindent
Your copy of the Chisel Tutorial repository will then be in \verb+$DIR/chisel-tutorial+.  Define this as a variable in your bash environment:

The following is the Chisel tutorial directory structure:

\begin{bash}
chisel-tutorial/  
  src/
    problems/
      Accumulator.scala ...
    solutions/
      Accumulator.scala ...
  emulator/
    problems/
      Makefile
    solutions/
      Makefile
  verilog/
    problems/
      Makefile
    solutions/
      Makefile
  sbt/
    project/
      build.scala
\end{bash}

\noindent 
The tutorial is split into problems and solutions, where the problems have some piece of the design to be filled in by the user and where the solutions are meant to be complete designs that should pass the given tests.  In order to run either, you change directory into the appropriate subdirectory and type make of the particular lesson name:

\begin{bash}
cd $CHISEL/tutorial/emulator/solutions
make GCD
\end{bash}

\noindent
or you can run all tests using

\begin{bash}
cd $CHISEL/tutorial/emulator/solutions
make all
\end{bash}

\noindent
and the output should show that all tests have passed.

In order to produce Verilog, just do the following:

\begin{bash}
cd $CHISEL/tutorial/verilog/solutions
make all
\end{bash}

\section{Creating Your Own Projects}

SBT has a particular directory structure that we adhere to and
somewhat improve.  Assuming that we have a project named {\em gpu},
then the following would be the directory structure template:

\begin{bash}
gpu/
  sbt/
    project/
      build.scala # edit this as shown below
  src/ 
    gpu.scala     # your source files go here
  emulator/       # your C++ target can go here
  verilog/        # your Verilog target can go here
\end{bash}

\noindent
and the following is the \verb+build.scala+ template:

\begin{scala}
import sbt._
import Keys._

object BuildSettings {
  val buildOrganization = "edu.berkeley.cs"
  val buildVersion = "1.1"
  val buildScalaVersion = "2.10.4"

  def apply(projectdir: String) = {
    Defaults.defaultSettings ++ Seq (
      organization := buildOrganization,
      version      := buildVersion,
      scalaVersion := buildScalaVersion,
      scalaSource in Compile := 
        Path.absolute(file(projectdir + "/src"))
      libraryDependencies += 
        "edu.berkeley.cs" %% "chisel" % "latest.release"
    )
  }
}

object ChiselBuild extends Build {
  import BuildSettings._
  lazy val gpu =
    Project("gpu", file("gpu"), 
            settings = BuildSettings("..")) 
      dependsOn(chisel)
}
\end{scala}

If you want to update your version of Chisel, all you have to do is
change the version number for Chisel.  For instance,

\begin{scala}
libraryDependencies += "edu.berkeley.cs" %% "chisel" % "1.0"
\end{scala}

\noindent
is using release 1.0, and

\begin{scala}
libraryDependencies += "edu.berkeley.cs" %% "chisel" % "1.0.1"
\end{scala}

\noindent
is using release 1.0.1

\end{document}
